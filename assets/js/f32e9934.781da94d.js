"use strict";(self.webpackChunksupport=self.webpackChunksupport||[]).push([[147],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var o=r.createContext({}),p=function(e){var t=r.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=p(e.components);return r.createElement(o.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,o=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=p(a),c=n,h=d["".concat(o,".").concat(c)]||d[c]||m[c]||l;return a?r.createElement(h,s(s({ref:t},u),{},{components:a})):r.createElement(h,s({ref:t},u))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,s=new Array(l);s[0]=c;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[d]="string"==typeof e?e:n,s[1]=i;for(var p=2;p<l;p++)s[p]=a[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}c.displayName="MDXCreateElement"},6411:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var r=a(7462),n=(a(7294),a(3905));const l={},s="Bases de donn\xe9es",i={unversionedId:"standards/databases",id:"standards/databases",title:"Bases de donn\xe9es",description:"Nous utilisons principalement PostgreSQL comme moteur de BDD relationnelle.",source:"@site/docs/standards/databases.md",sourceDirName:"standards",slug:"/standards/databases",permalink:"/support/docs/standards/databases",draft:!1,editUrl:"https://github.com/socialgouv/support/tree/master/docs/standards/databases.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Accessibilit\xe9 num\xe9rique",permalink:"/support/docs/standards/accessibilite"},next:{title:"S\xe9curit\xe9",permalink:"/support/docs/standards/securite"}},o={},p=[{value:"Recommandations",id:"recommandations",level:2},{value:"Debug",id:"debug",level:3},{value:"PgHero",id:"pghero",level:4},{value:"Hasura",id:"hasura",level:3},{value:"Conventions",id:"conventions",level:2},{value:"Chiffrement",id:"chiffrement",level:2},{value:"Skill up",id:"skill-up",level:2},{value:"Related",id:"related",level:2}],u={toc:p},d="wrapper";function m(e){let{components:t,...l}=e;return(0,n.kt)(d,(0,r.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"bases-de-donn\xe9es"},"Bases de donn\xe9es"),(0,n.kt)("p",null,"Nous utilisons principalement PostgreSQL comme moteur de BDD relationnelle."),(0,n.kt)("p",null,"La qualit\xe9 du mod\xe8le de donn\xe9es est cruciale dans le d\xe9veloppement :"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"simplification des applications qui vont exploiter ces donn\xe9es"),(0,n.kt)("li",{parentName:"ul"},"communication avec le reste de l'\xe9quipe (une s\xe9mantique commune)"),(0,n.kt)("li",{parentName:"ul"},"performance des requ\xeates"),(0,n.kt)("li",{parentName:"ul"},"int\xe9grit\xe9 des donn\xe9es"),(0,n.kt)("li",{parentName:"ul"},"s\xe9curit\xe9...")),(0,n.kt)("p",null,"Il est important de prendre le temps de concevoir un mod\xe8le de donn\xe9es coh\xe9rent et scalable que vous pourrez partager facilement avec les product owners (m\xe9tier) et faire \xe9voluer ensemble."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"L'\xe9quipe SRE est \xe0 votre disposition pour vous aider dans cette d\xe9marche.")),(0,n.kt)("p",null,(0,n.kt)("img",{src:a(9217).Z,title:":size=1000x450",width:"1840",height:"883"})),(0,n.kt)("h2",{id:"recommandations"},"Recommandations"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Les ",(0,n.kt)("a",{parentName:"li",href:"https://www.base-de-donnees.com/orm/"},"ORMs")," ne sont ",(0,n.kt)("em",{parentName:"li"},"pas")," recommand\xe9s, y pr\xe9f\xe9rrer des ",(0,n.kt)("inlineCode",{parentName:"li"},"query builders"),"."),(0,n.kt)("li",{parentName:"ul"},"En JS/TS, utiliser la lib ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/porsager/postgres"},"Postgres.js")," si possible"),(0,n.kt)("li",{parentName:"ul"},"Utiliser un linter de tag SQL ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/devthejo/eslint-plugin-sql-pretty"},"eslint-plugin-sql-pretty")),(0,n.kt)("li",{parentName:"ul"},"Utiliser un outil qui g\xe8re les migrations (ex: ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/porsager/postgres-shift"},"postgres-shift"),", ",(0,n.kt)("a",{parentName:"li",href:"https://hasura.io/docs/latest/graphql/core/migrations/migrations-setup/"},"hasura"),")"),(0,n.kt)("li",{parentName:"ul"},"Cr\xe9er des fichiers de seed pour vos environnements de test/review"),(0,n.kt)("li",{parentName:"ul"},"Maintenir un diagramme du mod\xe8le dans le repo, quelque outils:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://draw.io"},"draw.io")," language standard ouvert, bien pour d\xe9marrer la r\xe9flexion from sratch sur le mod\xe8le de donn\xe9es au d\xe9marrage du projet avant m\xeame de commencer \xe0 coder"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://dbeaver.io/download/"},"DBeaver")," outil d'administration complet de base de donn\xe9es, permettant d'exporter un ER mod\xe8le depuis une base de donn\xe9es existante pour pouvoir facilement retravailler dessus"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://www.yworks.com/products/yed"},"yEd")," g\xe8re le format de diagram export\xe9 par DBeaver"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/qweeze/pg_diagram"},"pg_diagram"))))),(0,n.kt)("h3",{id:"debug"},"Debug"),(0,n.kt)("h4",{id:"pghero"},"PgHero"),(0,n.kt)("p",null,"Vous pouvez lancer localement ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/ankane/pghero"},"PGHero")," et le connecter \xe0 votre base de donn\xe9es:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Ouvrir un port localement avec un ",(0,n.kt)("inlineCode",{parentName:"li"},"port-forward")," ou ",(0,n.kt)("inlineCode",{parentName:"li"},"teleport")),(0,n.kt)("li",{parentName:"ul"},"R\xe9cup\xe9rer le secret ",(0,n.kt)("inlineCode",{parentName:"li"},"pg-app")," dans votre namespace"),(0,n.kt)("li",{parentName:"ul"},"Lancer PGHero avec Docker : ")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sh"},"docker run -ti -e DATABASE_URL='postgresql://XXXX?sslmode=disable' -p 8080:8080 --net=host ankane/pghero\n")),(0,n.kt)("p",null,"Puis ouvrir ",(0,n.kt)("a",{parentName:"p",href:"http://127.0.0.1:8080"},"http://127.0.0.1:8080")),(0,n.kt)("h3",{id:"hasura"},"Hasura"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://hasura.io/"},"hasura")," est un composant battle-test\xe9 \xe0 la fabrique, qui se branche facilement sur votre base PostgreSQL."),(0,n.kt)("p",null,"Il permet d'exposer rapidement (low-code) une ",(0,n.kt)("a",{parentName:"p",href:"https://hasura.io/opensource/#features"},"API GraphQL avec des mod\xe8les, migrations, souscriptions, RBAC...")),(0,n.kt)("h2",{id:"conventions"},"Conventions"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://www.sqlstyle.guide/"},"SQL Style guide")),(0,n.kt)("li",{parentName:"ul"},"Positionner le diagramme dans ",(0,n.kt)("inlineCode",{parentName:"li"},"docs/db-model.png")," sur votre repo"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"yarn seed")," pour executer les seeds")),(0,n.kt)("h2",{id:"chiffrement"},"Chiffrement"),(0,n.kt)("p",null,"[todo]"),(0,n.kt)("h2",{id:"skill-up"},"Skill up"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\ud83c\uddeb\ud83c\uddf7 \ud83d\udc99 ",(0,n.kt)("a",{parentName:"li",href:"https://public.dalibo.com/exports/marketing/livres_blancs/dlb04-modeliser_avec_postgresql/DLB04_Modeliser_avec_PostgreSQL.pdf"},"Livre blanc ")," de ",(0,n.kt)("a",{parentName:"li",href:"https://www.dalibo.com/"},"Dalibo")," : Bonnes pratiques de mod\xe9lisation"),(0,n.kt)("li",{parentName:"ul"},"\ud83c\uddeb\ud83c\uddf7 \ud83d\udc99 ",(0,n.kt)("a",{parentName:"li",href:"https://www.youtube.com/playlist?list=PLn6POgpklwWonHjoGXXSIXJWYzPSy2FeJ"},"Vid\xe9os PostgreSQL de xavki")," : 34 vid\xe9os sur PostgreSQL et ses internals"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/dhamaniasad/awesome-postgres"},"awesome-postgres")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://tapoueh.org/blog/2018/03/database-modelization-anti-patterns/"},"DB Modelization anti-patterns")),(0,n.kt)("li",{parentName:"ul"},"\ud83c\uddeb\ud83c\uddf7 \ud83d\udc99 ",(0,n.kt)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=bo5j9xgiF48"},'Vid\xe9o Devoxx "Ce que les d\xe9veloppeurs doivent savoir sur les index"')),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://sqlfordevs.com/tips"},"Tips & ebook SQLforDevs.com"))),(0,n.kt)("h2",{id:"related"},"Related"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://www.pgcli.com/"},"pgcli : psql on stero\xefds")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://explain.depesz.com/s/6Pkc"},"Visual EXPLAIN")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://quickref.me/postgres"},"PostgreSQL cheatsheet")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/hasura/audit-trigger"},"PG audit log")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://prql-lang.org/"},"https://prql-lang.org/")),(0,n.kt)("li",{parentName:"ul"},"fun: ",(0,n.kt)("a",{parentName:"li",href:"https://oguimbal.github.io/pg-mem-playground/"},"Postgres in JS"))))}m.isMDXComponent=!0},9217:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/db-model-15221879bbb029fa0156377f7ea00223.png"}}]);