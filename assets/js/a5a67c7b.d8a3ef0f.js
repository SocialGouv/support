"use strict";(self.webpackChunksupport=self.webpackChunksupport||[]).push([[962],{5680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>g});var a=n(6540);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var o=a.createContext({}),u=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(o.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,r=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),m=s,g=d["".concat(o,".").concat(m)]||d[m]||c[m]||r;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function g(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[d]="string"==typeof e?e:s,i[1]=l;for(var u=2;u<r;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6993:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var a=n(8168),s=(n(6540),n(5680));const r={},i="S\xe9curit\xe9",l={unversionedId:"standards/securite",id:"standards/securite",title:"S\xe9curit\xe9",description:"\ud83d\udd12 Tous les acc\xe8s aux outils doivent \xeatre s\xe9curis\xe9s par authentification\xe0 deux",source:"@site/docs/standards/securite.md",sourceDirName:"standards",slug:"/standards/securite",permalink:"/support/docs/standards/securite",draft:!1,editUrl:"https://github.com/socialgouv/support/tree/master/docs/standards/securite.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Bases de donn\xe9es",permalink:"/support/docs/standards/databases"},next:{title:"Kubernetes (K8S)",permalink:"/support/docs/standards/kubernetes"}},o={},u=[{value:"Outils",id:"outils",level:2},{value:"DashLord : dashboard de s\xe9curit\xe9 et accessibilt\xe9",id:"dashlord--dashboard-de-s\xe9curit\xe9-et-accessibilt\xe9",level:3},{value:"SonarCloud : analyseur statique de code",id:"sonarcloud--analyseur-statique-de-code",level:3},{value:"Talisman : pr\xe9vention de publication de secrets",id:"talisman--pr\xe9vention-de-publication-de-secrets",level:3},{value:"ClamAV : scan antivirus de fichiers",id:"clamav--scan-antivirus-de-fichiers",level:3},{value:"Best practices",id:"best-practices",level:2},{value:"CODEOWNERS",id:"codeowners",level:3},{value:"Third-parties",id:"third-parties",level:3},{value:"Maintenance des d\xe9pendances",id:"maintenance-des-d\xe9pendances",level:3},{value:"Contr\xf4les d&#39;acc\xe8s",id:"contr\xf4les-dacc\xe8s",level:3},{value:"Leak d&#39;informations",id:"leak-dinformations",level:3},{value:"S\xe9curit\xe9 navigateurs",id:"s\xe9curit\xe9-navigateurs",level:3},{value:"Sessions",id:"sessions",level:3},{value:"Mots de passe",id:"mots-de-passe",level:3},{value:"Robustesse",id:"robustesse",level:4},{value:"Proc\xe9dure de changement de mot de passe",id:"proc\xe9dure-de-changement-de-mot-de-passe",level:4},{value:"Proc\xe9dure de reset de mot passe",id:"proc\xe9dure-de-reset-de-mot-passe",level:4},{value:"DDOS",id:"ddos",level:3},{value:"Logging",id:"logging",level:3},{value:"Exceptions",id:"exceptions",level:4},{value:"Logs applicatifs",id:"logs-applicatifs",level:4},{value:"Position de la CNIL",id:"position-de-la-cnil",level:5},{value:"Actions \xe0 logger",id:"actions-\xe0-logger",level:5},{value:"Upload de fichiers",id:"upload-de-fichiers",level:3},{value:"Risques",id:"risques",level:4},{value:"Mesures",id:"mesures",level:4},{value:"FAQ",id:"faq",level:2},{value:"Mettre \xe0 jour les headers HTTP de mes applications",id:"mettre-\xe0-jour-les-headers-http-de-mes-applications",level:3},{value:"Directement via l&#39;Ingress",id:"directement-via-lingress",level:4},{value:"C\xf4t\xe9 applicatif",id:"c\xf4t\xe9-applicatif",level:4},{value:"Chiffrer des fichiers",id:"chiffrer-des-fichiers",level:3},{value:"R\xe9f\xe9rences",id:"r\xe9f\xe9rences",level:2},{value:"G\xe9n\xe9ral",id:"g\xe9n\xe9ral",level:3},{value:"NodeJS",id:"nodejs",level:3},{value:"Docker",id:"docker",level:3}],p={toc:u},d="wrapper";function c(e){let{components:t,...n}=e;return(0,s.yg)(d,(0,a.A)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,s.yg)("h1",{id:"s\xe9curit\xe9"},"S\xe9curit\xe9"),(0,s.yg)("p",null,"\ud83d\udd12 Tous les acc\xe8s aux outils doivent \xeatre s\xe9curis\xe9s par authentification\xe0 deux\nfacteurs (2FA)."),(0,s.yg)("p",null,"\ud83c\udf10 Les variables d'environnement doivent \xeatre utilis\xe9es pour tout ce qui est\nsecrets, tokens, logins, urls, hostnames, etc."),(0,s.yg)("p",null,"\ud83d\udee1\ufe0f La gestion des secrets est assur\xe9e par des\n",(0,s.yg)("a",{parentName:"p",href:"https://github.com/bitnami-labs/sealed-secrets"},"sealed-secrets")," qui versionnent\nles secrets chiffr\xe9s dans GIT."),(0,s.yg)("h2",{id:"outils"},"Outils"),(0,s.yg)("h3",{id:"dashlord--dashboard-de-s\xe9curit\xe9-et-accessibilt\xe9"},"DashLord : dashboard de s\xe9curit\xe9 et accessibilt\xe9"),(0,s.yg)("p",null,"Accessible ici (se connecter pour voir plus d'informations) :\n",(0,s.yg)("a",{parentName:"p",href:"https://dashlord.fabrique.social.gouv.fr"},"https://dashlord.fabrique.social.gouv.fr"),"."),(0,s.yg)("p",null,"Voir aussi :\n",(0,s.yg)("a",{parentName:"p",href:"https://doc.incubateur.net/communaute/travailler-a-beta-gouv/jutilise-les-outils-de-la-communaute/dashlord"},"https://doc.incubateur.net/communaute/travailler-a-beta-gouv/jutilise-les-outils-de-la-communaute/dashlord"),"."),(0,s.yg)("h3",{id:"sonarcloud--analyseur-statique-de-code"},"SonarCloud : analyseur statique de code"),(0,s.yg)("p",null,"Les produits de l'organisation sont tous scann\xe9s et les r\xe9sultats sont\naccessibles ici : ",(0,s.yg)("a",{parentName:"p",href:"https://sonarcloud.io/organizations/socialgouv"},"https://sonarcloud.io/organizations/socialgouv"),"."),(0,s.yg)("h3",{id:"talisman--pr\xe9vention-de-publication-de-secrets"},"Talisman : pr\xe9vention de publication de secrets"),(0,s.yg)("p",null,"Publier involontairement un secret (par exemple un jeton d'acc\xe8s) sur un d\xe9p\xf4t\npublic peut avoir beaucoup de cons\xe9quences ind\xe9sirables. Une mani\xe8re efficace\nd'\xe9viter cela est d'ex\xe9cuter\n",(0,s.yg)("a",{parentName:"p",href:"https://github.com/thoughtworks/talisman/"},"un d\xe9tecteur de secrets comme ",(0,s.yg)("inlineCode",{parentName:"a"},"talisman")),"\nsur le hook ",(0,s.yg)("inlineCode",{parentName:"p"},"pre-commit")," de git."),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-bash"},'yarn add -D husky is-ci node-talisman\n\n# installer husky seulement si hors environnement de CI\nnpm pkg set scripts.postinstall="is-ci || husky install"\n\n# installation de husky gr\xe2ce au script de postinstall\nyarn\n\n# ex\xe9cuter node-talisman sur le hook de pre-commit\n# on d\xe9tecte ici si l\'interaction via un terminal est possible afin de ne pas\n# crash quand le pre-commit est lanc\xe9 par une application comme VSCode\nmkdir .husky\necho "if sh -c \': >/dev/tty\' >/dev/null 2>/dev/null; then exec </dev/tty; yarn node-talisman --githook pre-commit -i; else yarn node-talisman --githook pre-commit; fi" >  .husky/pre-commit\n\n# informe Talisman que le repo est en JS/TS\n# permet d\'\xe9viter de scanner yarn.lock par exemple\necho "scopeconfig:\\n  - scope: node" > .talismanrc\n')),(0,s.yg)("p",null,"On utilise ",(0,s.yg)("inlineCode",{parentName:"p"},"husky")," pour g\xe9rer simplement le hook. Si vous utilisez d\xe9j\xe0 un\ngestionnaire de hooks, vous pouvez y ajouter ",(0,s.yg)("inlineCode",{parentName:"p"},"node-talisman")," de mani\xe8re\nsimilaire."),(0,s.yg)("p",null,"On pourra observer des cas de faux positif de talisman, par exemple sur des\nmigrations SQL ou des donn\xe9es en base64. Dans ce cas, on lit attentivement le\nrapport, et on ajuste\n",(0,s.yg)("a",{parentName:"p",href:"https://github.com/thoughtworks/talisman/#ignoring-files"},"le fichier ",(0,s.yg)("inlineCode",{parentName:"a"},".talismanrc")),"\nen fonction."),(0,s.yg)("h3",{id:"clamav--scan-antivirus-de-fichiers"},"ClamAV : scan antivirus de fichiers"),(0,s.yg)("p",null,"Lorsqu'un produit propose \xe0 ses utilisateurs de ",(0,s.yg)("strong",{parentName:"p"},"t\xe9l\xe9verser des fichiers"),", il\nest recommand\xe9 de ",(0,s.yg)("strong",{parentName:"p"},"scanner")," les fichiers pour y d\xe9tecter de ",(0,s.yg)("strong",{parentName:"p"},"potentiels\nvirus"),". Dans ce but, la Fabrique met \xe0 disposition un service ",(0,s.yg)("strong",{parentName:"p"},"ClamAV"),"."),(0,s.yg)("p",null,"Impl\xe9menter dans l'application la communication avec le service antivirus. On\npassera par une interface REST afin d'envoyer un ou plusieurs fichiers et la\nr\xe9ponse mentionnera pour chacun d'eux si le fichier semble sain."),(0,s.yg)("p",null,"Le service REST utilis\xe9 est celui-ci :\n",(0,s.yg)("a",{parentName:"p",href:"https://github.com/benzino77/clamav-rest-api"},"https://github.com/benzino77/clamav-rest-api"),"."),(0,s.yg)("p",null,"Il est n\xe9cessaire d'envoyer les fichiers \xe0\n",(0,s.yg)("inlineCode",{parentName:"p"},"http://clamav-rest.clamav.svc/api/v1/scan")," encod\xe9s avec ",(0,s.yg)("inlineCode",{parentName:"p"},"multipart/form-data"),"\net sous la cl\xe9 ",(0,s.yg)("inlineCode",{parentName:"p"},"FILES"),"."),(0,s.yg)("admonition",{type:"info"},(0,s.yg)("p",{parentName:"admonition"},"Le service ClamAV n'est accessible que depuis l'int\xe9rieur de notre\ninfrastructure. Un scan ne peut donc \xeatre demand\xe9 que depuis le backend des\napplications, les clients n'y ont pas acc\xe8s.")),(0,s.yg)("p",null,"Exemple NodeJS :"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-js"},'const FormData = require("form-data");\nconst fs = require("fs");\n\nconst formData = new FormData();\nformData.append("FILES", fs.createReadStream("file1.txt"), "file1.txt");\nformData.append("FILES", fs.createReadStream("file2.txt"), "file2.txt");\n\nconst res = await fetch("http://clamav-rest.clamav.svc/api/v1/scan", {\n  method: "POST",\n  body: formData,\n  headers: formData.getHeaders(),\n});\nconsole.log(await res.json());\n')),(0,s.yg)("admonition",{type:"caution"},(0,s.yg)("p",{parentName:"admonition"},"Ce service de la Fabrique est exp\xe9rimental. Aucune application ne doit bloquer\nsur le scan antivirus car le service pourrait \xeatre indisponible.")),(0,s.yg)("h2",{id:"best-practices"},"Best practices"),(0,s.yg)("p",null,"Les ",(0,s.yg)("a",{parentName:"p",href:"https://cheatsheetseries.owasp.org/"},"cheat sheets OWASP")," sont une tr\xe8s\nbonne r\xe9f\xe9rence."),(0,s.yg)("h3",{id:"codeowners"},"CODEOWNERS"),(0,s.yg)("p",null,"Les workflows d'int\xe9gration et d\xe9ploiements continus des repositories SocialGouv\nsont prot\xe9g\xe9s par la convention\n",(0,s.yg)("a",{parentName:"p",href:"https://github.blog/2017-07-06-introducing-code-owners/"},"CODEOWNERS")," : tout\nchangement impactant potentiellement l'infrastructure doit \xeatre revue par une\npersonne de l'\xe9quipe OPS ou SRE. Ils seront automatiquement assign\xe9s aux issues\nqui touchent aux fichiers de CI lors d'une pull-request."),(0,s.yg)("h3",{id:"third-parties"},"Third-parties"),(0,s.yg)("p",null,"De mani\xe8re g\xe9n\xe9rale il est d\xe9conseill\xe9 de r\xe9f\xe9rencer des scripts externes dans\nses applications, comme des scripts ou CSS via CDN, google fonts ou autres\nservices tiers; Privil\xe9gier l'utilisation de librairies d\xe9di\xe9es que vous pouvez\nembarquer dans l'application elle-m\xeame."),(0,s.yg)("h3",{id:"maintenance-des-d\xe9pendances"},"Maintenance des d\xe9pendances"),(0,s.yg)("p",null,"Les packages utilis\xe9s dans les applications doivent \xeatre maintenus \xe0 jour et\nscann\xe9s r\xe9guli\xe8rement, id\xe9alement dans la CI."),(0,s.yg)("p",null,"Les packages non utilis\xe9s ou obsol\xe8tes doivent \xeatre supprim\xe9s."),(0,s.yg)("p",null,"Utilisez ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/SocialGouv/renovate-config"},"renovate")," pour\nmaintenir votre application \xe0 jour et pr\xe9voyez le temps n\xe9cessaire dans les\nsprints."),(0,s.yg)("h3",{id:"contr\xf4les-dacc\xe8s"},"Contr\xf4les d'acc\xe8s"),(0,s.yg)("p",null,"La mise en place d'un middleware de RBAC par lequel toutes les requ\xeates\nentrantes passent permet de rejeter au plus t\xf4t les requ\xeates ill\xe9gitimes et de\nmettre en place une liste blanche de pages ou endpoints non prot\xe9g\xe9s (le\ncomportement par d\xe9faut \xe9tant \"prot\xe9g\xe9\" pour \xe9viter l'introduction de d\xe9fauts de\ncontr\xf4le d'acc\xe8s au fur et \xe0 mesure des d\xe9veloppements)."),(0,s.yg)("p",null,"Ex : ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/nyambati/express-acl"},"https://github.com/nyambati/express-acl")),(0,s.yg)("p",null,"Mettre en place une ",(0,s.yg)("strong",{parentName:"p"},"matrice des r\xf4les")," qui associe \xe0 chaque type de donn\xe9e\ndes permissions de type lecture/\xe9criture par r\xf4le."),(0,s.yg)("h3",{id:"leak-dinformations"},"Leak d'informations"),(0,s.yg)("p",null,"Les informations techniques ne doivent pas \xeatre expos\xe9es au runtime. Les\nserveurs et applications ne doivent pas fournir de header ou signature\npermettant de les identifier. (ex: header ",(0,s.yg)("inlineCode",{parentName:"p"},"Served-by"),")"),(0,s.yg)("p",null,"Les donn\xe9es de d\xe9veloppement (GIT et bases de donn\xe9es) doivent \xeatre consid\xe9r\xe9es\ncomme publiques et ne pas utiliser de donn\xe9es sensibles ou personnelles."),(0,s.yg)("p",null,"Les d\xe9veloppeur(se)s ne doivent en aucun cas recevoir de donn\xe9es de production\nsur leur poste de travail. Les \xe9quipes de dev doivent mettre en oeuvre des\nm\xe9canismes de ",(0,s.yg)("inlineCode",{parentName:"p"},"seeds")," pour travailler avec des volumes de donn\xe9es r\xe9alistes."),(0,s.yg)("p",null,"Les applications ne doivent jamais logger d'information confidentielle ou de\ncredentials sur la console. En effet ces informations pourraient remonter sur\nles outils de logging tels Sentry ou grafana."),(0,s.yg)("h3",{id:"s\xe9curit\xe9-navigateurs"},"S\xe9curit\xe9 navigateurs"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},"D\xe9finir une ",(0,s.yg)("strong",{parentName:"li"},"content security policy (CSP) stricte"),", comme par exemple :\nen-t\xeate HTTP Content-Security-Policy: default-src 'self'; frame-ancestors\n'self'; Utiliser un outil comme\n",(0,s.yg)("a",{parentName:"li",href:"https://github.com/april/laboratory"},"Laboratory")," pour profiler votre\napplication et v\xe9rifier les headers CSP."),(0,s.yg)("li",{parentName:"ul"},"D\xe9finir l'attribut \"integrity\" sur l'ensemble des ressources link et script de\nla page (",(0,s.yg)("strong",{parentName:"li"},"SubResource Integrity"),")."),(0,s.yg)("li",{parentName:"ul"},"Gestion des ",(0,s.yg)("strong",{parentName:"li"},"cookies")," : utiliser les attributs de cookie ",(0,s.yg)("strong",{parentName:"li"},"HttpOnly, Secure\net SameSite"),'. Ne pas mettre SameSite \xe0 "None".'),(0,s.yg)("li",{parentName:"ul"},"Auto-h\xe9berger l'ensemble des ressources de la page. Pour celles qui ne peuvent\npas l'\xeatre et pour les traitements de moindre confiance, utiliser un WebWorker\nou une iFrame avec l'attribut \"sandbox\"."),(0,s.yg)("li",{parentName:"ul"},"Les verbes HTTP doivent \xeatre respect\xe9s, les op\xe9rations ",(0,s.yg)("inlineCode",{parentName:"li"},"GET")," ne doivent pas\nmodifier de donn\xe9es."),(0,s.yg)("li",{parentName:"ul"},"En cas d'utilisation de sessions, les op\xe9rations qui impactent des donn\xe9es\ndoivent \xeatre prot\xe9g\xe9es des\n",(0,s.yg)("a",{parentName:"li",href:"https://www.cert.ssi.gouv.fr/information/CERTA-2008-INF-003/"},"attaques de type CSRF"),"\navec un syst\xe8me de jeton.")),(0,s.yg)("p",null,"Ex: ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/helmetjs/helmet"},"https://github.com/helmetjs/helmet")),(0,s.yg)("h3",{id:"sessions"},"Sessions"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},"Les sessions des utilisateurs authentifi\xe9s doivent expirer automatiquement et\npouvoir \xeatre ferm\xe9es par l'utilisateur (cette action doit effectivement\nsupprimer la session c\xf4te serveur)."),(0,s.yg)("li",{parentName:"ul"},"Les sessions doivent pouvoir \xeatre ferm\xe9es par des administrateurs"),(0,s.yg)("li",{parentName:"ul"},"Dur\xe9e : Le d\xe9lai doit \xeatre adapt\xe9 \xe0 la dur\xe9e d'utilisation l\xe9gitime pr\xe9vue\n(pour les utilisateurs authentifi\xe9s) et \xe0 la sensibilit\xe9 des donn\xe9es. Ex: 6h\npour une s\xe9curit\xe9 moyenne")),(0,s.yg)("h3",{id:"mots-de-passe"},"Mots de passe"),(0,s.yg)("h4",{id:"robustesse"},"Robustesse"),(0,s.yg)("p",null,"Les empreintes de mot de passe doivent \xeatre stock\xe9es de fa\xe7on s\xe9curis\xe9e, en s'en\nremettant \xe0 une impl\xe9mentation propos\xe9e par le framework ou langage utilis\xe9,\napr\xe8s avoir v\xe9rifi\xe9 qu'il impl\xe9mente correctement une fonction ad\xe9quate pour le\nstockage des empreintes, telle que PBKDF2, Bcrypt, Scrypt ou Argon2, avec des\ncontraintes temps/m\xe9moire adapt\xe9es."),(0,s.yg)("p",null,(0,s.yg)("strong",{parentName:"p"},"Forcer la complexit\xe9 du mot de passe")," \xe0 : minimum 12 chars, 1 majuscule, 1\nminuscule, 1 chiffre, 1 caract\xe8re sp\xe9cial"),(0,s.yg)("p",null,"Proposer \xe0 l'utilisateur de lui g\xe9n\xe9rer."),(0,s.yg)("h4",{id:"proc\xe9dure-de-changement-de-mot-de-passe"},"Proc\xe9dure de changement de mot de passe"),(0,s.yg)("p",null,"Avertir par email l'utilisateur en cas de changement de mot passe."),(0,s.yg)("h4",{id:"proc\xe9dure-de-reset-de-mot-passe"},"Proc\xe9dure de reset de mot passe"),(0,s.yg)("p",null,"Voir r\xe9f\xe9rences\n",(0,s.yg)("a",{parentName:"p",href:"https://cheatsheetseries.owasp.org/cheatsheets/Forgot_Password_Cheat_Sheet.html"},"OWASP"),"\net\n",(0,s.yg)("a",{parentName:"p",href:"https://www.troyhunt.com/everything-you-ever-wanted-to-know/"},"building a secure password reset feature")),(0,s.yg)("p",null,"Avertir par email l'utilisateur en cas de changement de mot passe."),(0,s.yg)("p",null,"Voir aussi cet article sur les\n",(0,s.yg)("a",{parentName:"p",href:"https://hiddedevries.nl/en/blog/2018-01-13-making-password-managers-play-ball-with-your-login-form"},"forms de logins et passwords managers")),(0,s.yg)("h3",{id:"ddos"},"DDOS"),(0,s.yg)("p",null,"Les mesures de pr\xe9vention anti-DDOS et Waf doivent \xeatre mis en place en amont de\nl'application (c\xf4t\xe9 infra/reverse-proxy)"),(0,s.yg)("p",null,"C\xf4t\xe9 applicatif, l'utilisation de fonctions synchrones trop gourmandes en CPU\n(exemples : ",(0,s.yg)("inlineCode",{parentName:"p"},"readFileSync"),", ",(0,s.yg)("inlineCode",{parentName:"p"},"jwt.verify")," sans callback, ",(0,s.yg)("inlineCode",{parentName:"p"},"bcrypt.hashSync"),",\n",(0,s.yg)("inlineCode",{parentName:"p"},"bcrypt.genSaltSync"),") pr\xe9sente deux types de risques :"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("p",{parentName:"li"},(0,s.yg)("strong",{parentName:"p"},"c\xf4t\xe9 serveur")," : vuln\xe9rabilit\xe9 augment\xe9e au d\xe9ni de service (DOS),\nl'attaquant pouvant cibler les pages qui mettent en oeuvre ce type de\nfonctions c\xf4t\xe9 serveur pour diminuer le co\xfbt de l'attaque.")),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("p",{parentName:"li"},(0,s.yg)("strong",{parentName:"p"},"c\xf4t\xe9 client"),' : le blocage du fil d\'ex\xe9cution principal se traduit en un\n"freeze" d\xe9sagr\xe9able de la page'))),(0,s.yg)("p",null,"Il est recommand\xe9 de faire appel \xe0 la version asynchrone de ces fonctions, ou de\nles wrapper dans un thread ou web worker si elles n'ont pas d'impl\xe9mentation\nasynchrone disponible."),(0,s.yg)("h3",{id:"logging"},"Logging"),(0,s.yg)("h4",{id:"exceptions"},"Exceptions"),(0,s.yg)("p",null,"Journaliser explicitement les erreurs issues de la logique de l'application, qui\nsont inconnues du runtime. par exemple \xe0 l'aide de ",(0,s.yg)("a",{parentName:"p",href:"https://sentry.fabrique.social.gouv.fr"},"sentry"),". La remont\xe9e\nd'exceptions dans sentry doit veiller \xe0 ne pas remonter de donn\xe9es sensibles ou personnelles\n(ex: cookies)."),(0,s.yg)("h4",{id:"logs-applicatifs"},"Logs applicatifs"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},"L'application doit logger en JSON (cf ",(0,s.yg)("a",{parentName:"li",href:"/support/docs/standards/kubernetes"},"12 factors apps"),")"),(0,s.yg)("li",{parentName:"ul"},"L'application ne doit logger ",(0,s.yg)("strong",{parentName:"li"},"QUE")," les donn\xe9es n\xe9cessaires au bon fonctionnement du service"),(0,s.yg)("li",{parentName:"ul"},"Les utilisateurs de l'application doivent \xeatre inform\xe9s de cette journalisation"),(0,s.yg)("li",{parentName:"ul"},"Ces donn\xe9es techniques ne doivent ",(0,s.yg)("strong",{parentName:"li"},"PAS")," contenir de donn\xe9es permettant d'identifier un individu"),(0,s.yg)("li",{parentName:"ul"},"Les logs peuvent \xeatre conserv\xe9s jusqu'\xe0 12 mois si n\xe9cessaire")),(0,s.yg)("h5",{id:"position-de-la-cnil"},"Position de la CNIL"),(0,s.yg)("blockquote",null,(0,s.yg)("p",{parentName:"blockquote"},"\u201cDe ce point de vue, l\u2019enregistrement de ces donn\xe9es de journalisation ne rend pas le traitement plus intrusif, sous r\xe9serve que leur existence ne m\xe8ne pas \xe0 un d\xe9passement de la dur\xe9e de conservation des donn\xe9es. De plus, cette mesure peut apporter des garanties importantes pour la s\xe9curit\xe9 de ces donn\xe9es.\u201d")),(0,s.yg)("h5",{id:"actions-\xe0-logger"},"Actions \xe0 logger"),(0,s.yg)("p",null,"Certains actions peuvent \xeatre utiles \xe0 logger pour de l'audit de s\xe9curit\xe9"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},"actions destructives (suppression de donn\xe9es/fichiers)"),(0,s.yg)("li",{parentName:"ul"},"auth: tentatives de login, logout, changement/reset de pwd"),(0,s.yg)("li",{parentName:"ul"},"auth: erreurs 401/403"),(0,s.yg)("li",{parentName:"ul"},"upload/download T\xe9l\xe9chargement de document"),(0,s.yg)("li",{parentName:"ul"},"exports de donn\xe9es")),(0,s.yg)("p",null,"C\xf4t\xe9 base de donn\xe9es, un audit log peut \xeatre n\xe9cessaire. Ex:\n",(0,s.yg)("a",{parentName:"p",href:"https://github.com/hasura/audit-trigger"},"https://github.com/hasura/audit-trigger")," ou ",(0,s.yg)("a",{parentName:"p",href:"https://www.pgaudit.org"},"pgaudit")),(0,s.yg)("h3",{id:"upload-de-fichiers"},"Upload de fichiers"),(0,s.yg)("h4",{id:"risques"},"Risques"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("strong",{parentName:"li"},"perte d'int\xe9grit\xe9 comportement/contenu")," : remplacement de code applicatif\nau moyen d'un fichier upload\xe9 / h\xe9bergement de contenu illicite (ex\xe9cution non\nma\xeetris\xe9e ou m\xe9sinterpr\xe9tation du contenu)"),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("strong",{parentName:"li"},"perte de confidentialit\xe9")," : fuite de documents (d\xe9faut de contr\xf4le d'acc\xe8s)"),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("strong",{parentName:"li"},"perte de disponibilit\xe9")," : d\xe9ni de service de l'application (d\xe9faut de\nlimitation en ressources)")),(0,s.yg)("h4",{id:"mesures"},"Mesures"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("strong",{parentName:"li"},"Upload")," :",(0,s.yg)("ul",{parentName:"li"},(0,s.yg)("li",{parentName:"ul"},"Limiter la taille du fichier"),(0,s.yg)("li",{parentName:"ul"},"V\xe9rifier type mime envoy\xe9 par le client et le comparer \xe0 une liste blanche\npr\xe9-\xe9tablie, le stocker, puis refl\xe9ter la m\xeame valeur lors du download du\nfichier par un utilisateur"),(0,s.yg)("li",{parentName:"ul"},"Si un traitement doit \xeatre r\xe9alis\xe9, le d\xe9porter sur un webservice d\xe9di\xe9"))),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("strong",{parentName:"li"},"Stockage")," :",(0,s.yg)("ul",{parentName:"li"},(0,s.yg)("li",{parentName:"ul"},"Stocker les fichiers dans un emplacement impos\xe9, hors du document root, dans\nune partition d\xe9di\xe9e, ou en base de donn\xe9es"),(0,s.yg)("li",{parentName:"ul"},"Ne pas utiliser le nom fourni dans les en-t\xeates HTTP pour le stockage direct\ndu fichier (exemple : utiliser un ",(0,s.yg)("inlineCode",{parentName:"li"},"sha-256")," sal\xe9 sur le nom ou encore un\njeton d'acc\xe8s al\xe9atoire avec lequel la correspondance sera faite en base -\nne pas conserver l'extension)"))),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("strong",{parentName:"li"},"Download")," :",(0,s.yg)("ul",{parentName:"li"},(0,s.yg)("li",{parentName:"ul"},"Utilisation un contr\xf4leur qui induit un niveau d'abstraction entre la fa\xe7on\nde r\xe9cup\xe9rer le fichier et la situation r\xe9elle c\xf4t\xe9 serveur. (exemple : GET\n",(0,s.yg)("inlineCode",{parentName:"li"},"/download?[random_token]")," VS GET ",(0,s.yg)("inlineCode",{parentName:"li"},"/static/mnt/volume/fichier.pdf"),")"),(0,s.yg)("li",{parentName:"ul"},"Utiliser l'en-t\xeate ",(0,s.yg)("inlineCode",{parentName:"li"},"Content-Disposition: attachement")," afin de forcer le\nt\xe9l\xe9chargement"),(0,s.yg)("li",{parentName:"ul"},"Utiliser l'en-t\xeate ",(0,s.yg)("inlineCode",{parentName:"li"},"Content-Type")," avec la valeur \xe9mise lors de l'upload"),(0,s.yg)("li",{parentName:"ul"},"Utiliser l'en-t\xeate ",(0,s.yg)("inlineCode",{parentName:"li"},"X-Content-Type-Options: nosniff")," afin d'emp\xeacher le\nnavigateur d'inf\xe9rer le type du fichier et de lui demander de respecter le\nContent-Type que l'on aura positionn\xe9.")))),(0,s.yg)("h2",{id:"faq"},"FAQ"),(0,s.yg)("h3",{id:"mettre-\xe0-jour-les-headers-http-de-mes-applications"},"Mettre \xe0 jour les headers HTTP de mes applications"),(0,s.yg)("p",null,"Inspectez les headers HTTP de votre frontend avec\n",(0,s.yg)("a",{parentName:"p",href:"https://observatory.mozilla.org/"},"Mozilla HTTP Observatory"),". Vous pouvez\n\xe9galement les retrouver sur\n",(0,s.yg)("a",{parentName:"p",href:"https://dashlord-full.fabrique.social.gouv.fr/"},"DashLord"),"."),(0,s.yg)("p",null,"Plusieurs possibilit\xe9s pour corriger vos headers :"),(0,s.yg)("h4",{id:"directement-via-lingress"},"Directement via l'Ingress"),(0,s.yg)("p",null,"Il est possible d'ajouter des annotations pour forcer les headers directement\nsur la route de votre application."),(0,s.yg)("p",null,"Exemple avec kontinuous ou kube-workflow, dans le ",(0,s.yg)("inlineCode",{parentName:"p"},"values.yaml")," de votre\napplication :"),(0,s.yg)("pre",null,(0,s.yg)("code",{parentName:"pre",className:"language-yaml"},"app:\n  ingress:\n    annotations:\n      nginx.ingress.kubernetes.io/configuration-snippet: |\n        more_set_headers \"Content-Security-Policy: default-src 'none'; connect-src 'self' https://*.gouv.fr; font-src 'self'; img-src 'self'; prefetch-src 'self' https://*.gouv.fr; script-src 'self' https://*.gouv.fr; frame-src 'self' https://*.gouv.fr; style-src 'self' 'unsafe-inline'\";\n        more_set_headers \"X-Frame-Options: deny\";\n        more_set_headers \"X-XSS-Protection: 1; mode=block\";\n        more_set_headers \"X-Content-Type-Options: nosniff\";\n")),(0,s.yg)("p",null,"La CSP est \xe0 adapter selon vos scripts externes; vous pouvez la d\xe9finir\nmanuellement ou avec l'extension\n",(0,s.yg)("a",{parentName:"p",href:"https://github.com/april/laboratory"},"CSP laboratory"),"."),(0,s.yg)("p",null,"Le repo ",(0,s.yg)("a",{parentName:"p",href:"https://github.com/SocialGouv/template"},"template")," pr\xe9sente\nl'int\xe9gration dans un Next.js statique (branche ",(0,s.yg)("inlineCode",{parentName:"p"},"main"),") ou avec un serveur\n(branche ",(0,s.yg)("inlineCode",{parentName:"p"},"hasura"),")."),(0,s.yg)("h4",{id:"c\xf4t\xe9-applicatif"},"C\xf4t\xe9 applicatif"),(0,s.yg)("p",null,"Il est possible d'ajouter les headers c\xf4t\xe9 applicatif, par exemple avec\n",(0,s.yg)("a",{parentName:"p",href:"https://github.com/helmetjs/helmet"},"helmet"),"."),(0,s.yg)("h3",{id:"chiffrer-des-fichiers"},"Chiffrer des fichiers"),(0,s.yg)("p",null,"Si vous souhaitez chiffrer des fichiers c\xf4t\xe9 serveur, vous pouvez utiliser le\nmodule\n",(0,s.yg)("a",{parentName:"p",href:"https://github.com/SocialGouv/streaming-file-encryption"},"streaming-file-encryption"),"."),(0,s.yg)("p",null,"La s\xe9curit\xe9 de ce module repose sur la connaissance n\xe9cessaire de 3 informations\ndisctinctes pour pouvoir d\xe9chiffrer un fichier :"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},"Le ",(0,s.yg)("inlineCode",{parentName:"li"},"mainSecret")," \xe0 d\xe9finir en tant que variable d'environnement c\xf4t\xe9 applicatif"),(0,s.yg)("li",{parentName:"ul"},"Le ",(0,s.yg)("inlineCode",{parentName:"li"},"context")," \xe0 stocker dans votre base de donn\xe9es et li\xe9 \xe0 votre fichier"),(0,s.yg)("li",{parentName:"ul"},"Le ",(0,s.yg)("inlineCode",{parentName:"li"},"ciphertext")," \xe0 stocker sur un volume disque persistant")),(0,s.yg)("p",null,"\u26a0\ufe0f il est essentiel de stocker ces donn\xe9es dans des espaces isol\xe9s."),(0,s.yg)("p",null,"Les fichiers chiffr\xe9s r\xe9pondent\xa0aux propri\xe9t\xe9s cryptographiques suivantes :"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},"R\xe9sistance \xe0 la falsification (modification des donn\xe9es)"),(0,s.yg)("li",{parentName:"ul"},"R\xe9sistance \xe0 la troncature (suppression des donn\xe9es \xe0 chaque extr\xe9mit\xe9 ou au\nmilieu)"),(0,s.yg)("li",{parentName:"ul"},"R\xe9sistance \xe0 l'extension (ajout de donn\xe9es \xe0 chaque extr\xe9mit\xe9 ou au milieu)"),(0,s.yg)("li",{parentName:"ul"},"R\xe9sistance \xe0 la r\xe9organisation (\xe9change de pages de donn\xe9es)")),(0,s.yg)("h2",{id:"r\xe9f\xe9rences"},"R\xe9f\xe9rences"),(0,s.yg)("h3",{id:"g\xe9n\xe9ral"},"G\xe9n\xe9ral"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://www.ssi.gouv.fr/uploads/2018/11/guide-securite-numerique-agile-anssi-pa-v1.pdf"},"guide ANSSI de la s\xe9curit\xe9 agile")),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://cheatsheetseries.owasp.org/"},"https://cheatsheetseries.owasp.org/")),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://www.ssi.gouv.fr/guide/mot-de-passe/"},"https://www.ssi.gouv.fr/guide/mot-de-passe/")),(0,s.yg)("li",{parentName:"ul"},"Reset password best practices :\n",(0,s.yg)("a",{parentName:"li",href:"https://www.troyhunt.com/everything-you-ever-wanted-to-know/"},"https://www.troyhunt.com/everything-you-ever-wanted-to-know/"))),(0,s.yg)("h3",{id:"nodejs"},"NodeJS"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://www.sqreen.com/checklists/nodejs-security-handbook"},"https://www.sqreen.com/checklists/nodejs-security-handbook")),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://github.com/goldbergyoni/nodebestpractices#6-security-best-practices"},"https://github.com/goldbergyoni/nodebestpractices#6-security-best-practices")),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://github.com/nodejs/docker-node/blob/master/docs/BestPractices.md"},"https://github.com/nodejs/docker-node/blob/master/docs/BestPractices.md"))),(0,s.yg)("h3",{id:"docker"},"Docker"),(0,s.yg)("ul",null,(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://www.ssi.gouv.fr/administration/publication/recommandations-de-securite-relatives-au-deploiement-de-conteneurs-docker/"},"https://www.ssi.gouv.fr/administration/publication/recommandations-de-securite-relatives-au-deploiement-de-conteneurs-docker/")),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/"},"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/")),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://snyk.io/blog/10-docker-image-security-best-practices/"},"https://snyk.io/blog/10-docker-image-security-best-practices/")),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://github.com/OWASP/Docker-Security"},"https://github.com/OWASP/Docker-Security")),(0,s.yg)("li",{parentName:"ul"},(0,s.yg)("a",{parentName:"li",href:"https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Docker_Security_Cheat_Sheet.md"},"https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Docker_Security_Cheat_Sheet.md"))))}c.isMDXComponent=!0}}]);